<script>
	console.log('executing form script')
	var submitForm = function(event){
		event.preventDefault();
		$submitButton = $(event.target).parent().find('#form-itable-submit');
		$submitButton.attr({disabled: 'true', value: 'Submitting..'});
		$(event.target).off('submit');
		console.log('attempting to submit form');
		var formData = $(event.target).serialize();

		$.ajax({
			url:'/results',
			type: 'POST',
			data: formData,
			success: function(url){				
				console.log('submission successful, redirecting to ' + url)
				if(url){
					window.location.href = url;
				} else {
					$submitButton.val('Form Successfully Submitted');
				}
			},
			error: function(response, response2, response3, response4){
				console.log('submission unsuccessful')
				console.log(response);
				console.log(response2);
				console.log(response3);
				console.log(response4);
				
				$(event.target).on('submit', function(event){
					submitForm(event);
				});
				$submitButton.removeAttr('disabled').val('Submit');
			}
		});
	}
	$(function(){
		$('.fi-30x form').on('submit', function(event){
			submitForm(event);
		})
	});

</script>